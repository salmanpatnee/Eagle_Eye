<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class PenTestFinding extends Model
{
    use HasFactory;

    protected $table = 'va_pt_test_findings_table';
    protected $guarded = [];
    public $timestamps = false;
    protected $dates = ['va_pt_discovery_date', 'va_pt_closing_date'];

    const SEVERITY_LEVELS = [
        'Critical',
        'High',
        'Medium',
        'Low'
    ];

    const STATUSES = [
        'Open - Not Started',
        'Open - WIP',
        'Closed'
    ];

    public function penTest()
    {
        return $this->belongsTo(PenTest::class, 'va_pt_test_id', 'va_pt_test_id');
    }

    public function owner()
    {
        return $this->belongsTo(Owner::class, 'owner_id', 'owner_role_id');
    }

    public function custodians()
    {
        return $this->belongsToMany(
            Custodian::class,
            'va_pt_test_table_vs_custodian_role_table',
            'va_pt_finding_id',
            'custodian_id',
            'va_pt_finding_id',
            'custodian_role_id'
        );
    }

    public function patches()
    {
        return $this->belongsToMany(
            Patch::class,
            'va_pt_findings_table_vs_patches_table',
            'va_pt_finding_id',
            'patch_id',
            'va_pt_finding_id',
            'patch_id'
        );
    }

    public function assets()
    {
        return $this->belongsToMany(
            Asset::class,
            'va_pt_test_table_vs_asset_table',
            'va_pt_finding_id',
            'asset_id',
            'va_pt_finding_id',
            'asset_id'
        );
    }

    public function assetGroups()
    {
        return $this->belongsToMany(
            AssetGroup::class,
            'va_pt_findings_table_vs_asset_group_table',
            'va_pt_finding_id',
            'asset_group_id',
            'va_pt_finding_id',
            'asset_group_id'
        );
    }

    public function pocs()
    {
        return $this->hasMany(VAFindingAttachment::class, 'finding_id', 'id');
    }
}
