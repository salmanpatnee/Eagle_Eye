@extends('partials.app-layout')

@section('content')
    <section class="py-4">
        <div class="container-fluid">
            <div class="row">
                <div class="d-flex">

                    <div class="col-12 col-lg-5 text-lg-start">
                        <h3 class="fs-2 fw-bold">اختبار اختراق الثغرات</h3>
                        <small>Vulnerability Pen Test</small>
                    </div>

                    <div
                        class="align-content-center col-lg-7 col-12 d-flex flex-wrap justify-content-lg-end justify-content-center">

                        <a href="{{ route('pen-test.index') }}" class="btn btn-theme btn-sm px-5 me-2">منظر <br>
                            View
                        </a>

                        <a href="{{ route('pen-test.create') }}"
                            class="{{ auth()->user()->can('manage-asset') ? 'btn btn-theme btn-sm px-5 me-2' : 'btn btn-theme btn-sm px-5 me-2 not-allow' }}">يضيف
                            <br>
                            Add
                        </a>

                        <a href="" id="btnUpdate"
                            class="{{ auth()->user()->can('manage-asset') ? 'btn btn-theme btn-sm px-5 me-2' : 'btn btn-theme btn-sm px-5 me-2 not-allow' }}">تحديث
                            <br>
                            Update
                        </a>

                        <button type="button" id="btnDelete" class="btn btn-theme btn-sm px-5" {{ !auth()->user()->can('delete-data') ? 'disabled' : null }}>يمسح <br> Delete </button>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <div class="container-fluid">
        <form  method="POST" action="{{ route('pen-test.delete') }}" id="deleteForm">
            @csrf
            @method('DELETE')
        <div class="table-responsive rounded-3">
                <table class="table  rounded-3 table-bordered">
                    <thead>
                        <tr class="table-theme-secondary">
                            <th>

                            </th>
                            <th>S.No</th>
                            <th>
                                {{-- رمز المخاطر
                                <br><br> --}}
                                VA Pen Test ID
                            </th>
                            <th>
                                VA Pen Test Name
                            </th>
                            {{-- <th>
                            Description
                        </th> --}}
                            <th>
                                Start and End Date
                            </th>
                            <th>
                                Findings
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach ($tests as $test)
                            <tr>
                                <td>
                                    <input type="radio" name="record" class="record"
                                        value="{{ $test->$primaryKey }}" required>
                                </td>

                                <td>{{ $loop->index + 1 }}</td>
                                <td>
                                    <a
                                        href="{{ route('pen-test.show', $test->va_pt_test_id) }}">

                                        {{ $test->va_pt_test_id }}
                                    </a>
                                </td>

                                <td>{{ $test->va_pt_test_name }}
                                </td>
                                {{-- <td>{{ $test->control_assessment_description }}
                            </td> --}}
                                <td>{{ $test->start_end_date }}
                                </td>
                                <td>
                                    <ul class="list-unstyled mb-0 text-end">
                                        @forelse ($test->findings as $finding)
                                            <li class="d-flex  justify-content-between mb-1">
                                                <span>
                                                    <a
                                                        href="{{ route('pen-test-findings.show', $finding->va_pt_finding_id) }}">
                                                        {{ $finding->va_pt_finding_id }}
                                                    </a>
                                                </span>
                                                <div class="btn-group" role="group">
                                                    <a href="{{ route('pen-test-findings.create', $test->va_pt_test_id) }}"
                                                        class="{{auth()->user()->can('manage-asset') ? 'btn btn-outline-dark btn-sm text-decoration-none' : 'btn btn-outline-dark btn-sm text-decoration-none not-allow'}}" >Add Findings
                                                        <br>إضافة نتيجة
                                                    </a>
                                                </div>
                                            </li>
                                        @empty
                                            <li class="mb-0">
                                                <a href="{{ route('pen-test-findings.create', $test->va_pt_test_id) }}"
                                                    class="{{auth()->user()->can('manage-asset') ? 'btn btn-outline-dark btn-sm text-decoration-none' : 'btn btn-outline-dark btn-sm text-decoration-none not-allow'}}" >Add Findings
                                                    <br>إضافة نتيجة
                                                </a>

                                            </li>
                                        @endforelse
                                    </ul>
                                </td>
                            </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
        </form>
    </div>
    @include('components.delete-confirmation-modal')

    <script>

document.getElementById('btnDelete').addEventListener('click', function(event) {
    event.preventDefault();
    const selectedRadio = document.querySelector('.record:checked');

    if (selectedRadio) {
        window.deleteConfirmationModal.show(document.getElementById('deleteForm'));
    } else {
        alert('Please select a record to delete.');
    }
});

        document.getElementById('btnUpdate').addEventListener('click', function(event) {
            event.preventDefault();

            const selectedRadio = document.querySelector('.record:checked');

            if (selectedRadio) {
                window.location.href = `/va-pen-test/edit/${selectedRadio.value}`;
            } else {
                alert('Please select a record.');
            }
        });

        // document.querySelectorAll('.form-check-input').forEach(function(checkbox) {
        //     checkbox.addEventListener('change', function() {
        //         let selectedValues = Array.from(document.querySelectorAll('.form-check-input:checked'))
        //             .map(function(checkedBox) {
        //                 return checkedBox.value;
        //             });

        //         document.getElementById('assessments').value = selectedValues.join(',');
        //     });
        // });
    </script>
@endsection
